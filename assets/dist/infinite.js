"use strict";

/**
 * Infinite Scroll
 */
(function (window, document) {
  // next link element
  var nextElement = document.querySelector('link[rel=next]');
  if (!nextElement) return; // post feed element

  var feedElement = document.querySelector('.post-feed');
  if (!feedElement) return; // pagination element

  var paginationElement = document.querySelector('.pagination');
  var buffer = 300;
  var ticking = false;
  var loading = false;
  var lastScrollY = window.scrollY;
  var lastWindowHeight = window.innerHeight;
  var lastDocumentHeight = document.documentElement.scrollHeight;

  function appendContent() {
    if (this.status === 404) {
      window.removeEventListener('scroll', onScroll);
      window.removeEventListener('resize', onResize);
      return;
    } // // https://github.com/TryGhost/Casper/commit/41bcbb71570db0f829a2f0f1b5549f380d38d36a
    // document.createRange().createContextualFragment(this.responseText)
    // window.LazyLoad && new window.LazyLoad({ elements_selector: '[data-src]' })
    // append contents


    var postElements = this.response.querySelectorAll('.post-card');
    postElements.forEach(function (item) {
      return feedElement.appendChild(item);
    });
    window.lazyloader && window.lazyloader.update();

    if (paginationElement) {
      // append new pagination
      var newPaginationElement = this.response.querySelector('.pagination');
      paginationElement.innerHTML = newPaginationElement.innerHTML;
    } // push state


    window.history.pushState(null, document.title, nextElement.href); // change title

    document.title = this.response.title; // set next link

    var newNextElement = this.response.querySelector('link[rel=next]');

    if (newNextElement) {
      nextElement.href = newNextElement.href;
    } else {
      window.removeEventListener('scroll', onScroll);
      window.removeEventListener('resize', onResize);
    } // sync status


    lastDocumentHeight = document.documentElement.scrollHeight;
    ticking = false;
    loading = false;
  }

  function update() {
    // return if already loading
    if (loading) return; // return if not scroll to the bottom

    if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {
      ticking = false;
      return;
    }

    loading = true;
    var xhr = new window.XMLHttpRequest();
    xhr.responseType = 'document';
    xhr.addEventListener('load', appendContent);
    xhr.open('GET', nextElement.href);
    xhr.send(null);
  }

  function requestTick() {
    ticking || window.requestAnimationFrame(update);
    ticking = true;
  }

  function onScroll() {
    lastScrollY = window.scrollY;
    requestTick();
  }

  function onResize() {
    lastWindowHeight = window.innerHeight;
    lastDocumentHeight = document.documentElement.scrollHeight;
    requestTick();
  }

  window.addEventListener('scroll', onScroll, {
    passive: true
  });
  window.addEventListener('resize', onResize);
  requestTick();
})(window, document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZmluaXRlLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsImRvY3VtZW50IiwibmV4dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZmVlZEVsZW1lbnQiLCJwYWdpbmF0aW9uRWxlbWVudCIsImJ1ZmZlciIsInRpY2tpbmciLCJsb2FkaW5nIiwibGFzdFNjcm9sbFkiLCJzY3JvbGxZIiwibGFzdFdpbmRvd0hlaWdodCIsImlubmVySGVpZ2h0IiwibGFzdERvY3VtZW50SGVpZ2h0IiwiZG9jdW1lbnRFbGVtZW50Iiwic2Nyb2xsSGVpZ2h0IiwiYXBwZW5kQ29udGVudCIsInN0YXR1cyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJvblNjcm9sbCIsIm9uUmVzaXplIiwicG9zdEVsZW1lbnRzIiwicmVzcG9uc2UiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBlbmRDaGlsZCIsImxhenlsb2FkZXIiLCJ1cGRhdGUiLCJuZXdQYWdpbmF0aW9uRWxlbWVudCIsImlubmVySFRNTCIsImhpc3RvcnkiLCJwdXNoU3RhdGUiLCJ0aXRsZSIsImhyZWYiLCJuZXdOZXh0RWxlbWVudCIsInhociIsIlhNTEh0dHBSZXF1ZXN0IiwicmVzcG9uc2VUeXBlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW4iLCJzZW5kIiwicmVxdWVzdFRpY2siLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJwYXNzaXZlIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7QUFJQSxDQUFDLFVBQVVBLE1BQVYsRUFBa0JDLFFBQWxCLEVBQTRCO0FBQzNCO0FBQ0EsTUFBTUMsV0FBVyxHQUFHRCxRQUFRLENBQUNFLGFBQVQsQ0FBdUIsZ0JBQXZCLENBQXBCO0FBQ0EsTUFBSSxDQUFDRCxXQUFMLEVBQWtCLE9BSFMsQ0FLM0I7O0FBQ0EsTUFBTUUsV0FBVyxHQUFHSCxRQUFRLENBQUNFLGFBQVQsQ0FBdUIsWUFBdkIsQ0FBcEI7QUFDQSxNQUFJLENBQUNDLFdBQUwsRUFBa0IsT0FQUyxD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QUFDRyxnQkFBSixDQUFxQixNQUFyQixFQUE2QnZCLGFBQTdCO0FBRUFvQixJQUFBQSxHQUFHLENBQUNJLElBQUosQ0FBUyxLQUFULEVBQWdCdEMsV0FBVyxDQUFDZ0MsSUFBNUI7QUFDQUUsSUFBQUEsR0FBRyxDQUFDSyxJQUFKLENBQVMsSUFBVDtBQUNEOztBQUVELFdBQVNDLFdBQVQsR0FBd0I7QUFDdEJuQyxJQUFBQSxPQUFPLElBQUlQLE1BQU0sQ0FBQzJDLHFCQUFQLENBQTZCZixNQUE3QixDQUFYO0FBQ0FyQixJQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUNEOztBQUVELFdBQVNZLFFBQVQsR0FBcUI7QUFDbkJWLElBQUFBLFdBQVcsR0FBR1QsTUFBTSxDQUFDVSxPQUFyQjtBQUNBZ0MsSUFBQUEsV0FBVztBQUNaOztBQUVELFdBQVN0QixRQUFULEdBQXFCO0FBQ25CVCxJQUFBQSxnQkFBZ0IsR0FBR1gsTUFBTSxDQUFDWSxXQUExQjtBQUNBQyxJQUFBQSxrQkFBa0IsR0FBR1osUUFBUSxDQUFDYSxlQUFULENBQXlCQyxZQUE5QztBQUNBMkIsSUFBQUEsV0FBVztBQUNaOztBQUVEMUMsRUFBQUEsTUFBTSxDQUFDdUMsZ0JBQVAsQ0FBd0IsUUFBeEIsRUFBa0NwQixRQUFsQyxFQUE0QztBQUFFeUIsSUFBQUEsT0FBTyxFQUFFO0FBQVgsR0FBNUM7QUFDQTVDLEVBQUFBLE1BQU0sQ0FBQ3VDLGdCQUFQLENBQXdCLFFBQXhCLEVBQWtDbkIsUUFBbEM7QUFFQXNCLEVBQUFBLFdBQVc7QUFDWixDQXpHRCxFQXlHRzFDLE1BekdILEVBeUdXQyxRQXpHWCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBJbmZpbml0ZSBTY3JvbGxcclxuICovXHJcblxyXG4oZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQpIHtcclxuICAvLyBuZXh0IGxpbmsgZWxlbWVudFxyXG4gIGNvbnN0IG5leHRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbGlua1tyZWw9bmV4dF0nKVxyXG4gIGlmICghbmV4dEVsZW1lbnQpIHJldHVyblxyXG5cclxuICAvLyBwb3N0IGZlZWQgZWxlbWVudFxyXG4gIGNvbnN0IGZlZWRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvc3QtZmVlZCcpXHJcbiAgaWYgKCFmZWVkRWxlbWVudCkgcmV0dXJuXHJcblxyXG4gIC8vIHBhZ2luYXRpb24gZWxlbWVudFxyXG4gIGNvbnN0IHBhZ2luYXRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhZ2luYXRpb24nKVxyXG5cclxuICBjb25zdCBidWZmZXIgPSAzMDBcclxuXHJcbiAgbGV0IHRpY2tpbmcgPSBmYWxzZVxyXG4gIGxldCBsb2FkaW5nID0gZmFsc2VcclxuXHJcbiAgbGV0IGxhc3RTY3JvbGxZID0gd2luZG93LnNjcm9sbFlcclxuICBsZXQgbGFzdFdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodFxyXG4gIGxldCBsYXN0RG9jdW1lbnRIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0XHJcblxyXG4gIGZ1bmN0aW9uIGFwcGVuZENvbnRlbnQgKCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdHVzID09PSA0MDQpIHtcclxuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG9uU2Nyb2xsKVxyXG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25SZXNpemUpXHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9UcnlHaG9zdC9DYXNwZXIvY29tbWl0LzQxYmNiYjcxNTcwZGIwZjgyOWEyZjBmMWI1NTQ5ZjM4MGQzOGQzNmFcclxuICAgIC8vIGRvY3VtZW50LmNyZWF0ZVJhbmdlKCkuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KHRoaXMucmVzcG9uc2VUZXh0KVxyXG4gICAgLy8gd2luZG93LkxhenlMb2FkICYmIG5ldyB3aW5kb3cuTGF6eUxvYWQoeyBlbGVtZW50c19zZWxlY3RvcjogJ1tkYXRhLXNyY10nIH0pXHJcblxyXG4gICAgLy8gYXBwZW5kIGNvbnRlbnRzXHJcbiAgICBjb25zdCBwb3N0RWxlbWVudHMgPSB0aGlzLnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3N0LWNhcmQnKVxyXG4gICAgcG9zdEVsZW1lbnRzLmZvckVhY2goaXRlbSA9PiBmZWVkRWxlbWVudC5hcHBlbmRDaGlsZChpdGVtKSlcclxuICAgIHdpbmRvdy5sYXp5bG9hZGVyICYmIHdpbmRvdy5sYXp5bG9hZGVyLnVwZGF0ZSgpXHJcblxyXG4gICAgaWYgKHBhZ2luYXRpb25FbGVtZW50KSB7XHJcbiAgICAgIC8vIGFwcGVuZCBuZXcgcGFnaW5hdGlvblxyXG4gICAgICBjb25zdCBuZXdQYWdpbmF0aW9uRWxlbWVudCA9IHRoaXMucmVzcG9uc2UucXVlcnlTZWxlY3RvcignLnBhZ2luYXRpb24nKVxyXG4gICAgICBwYWdpbmF0aW9uRWxlbWVudC5pbm5lckhUTUwgPSBuZXdQYWdpbmF0aW9uRWxlbWVudC5pbm5lckhUTUxcclxuICAgIH1cclxuXHJcbiAgICAvLyBwdXNoIHN0YXRlXHJcbiAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgZG9jdW1lbnQudGl0bGUsIG5leHRFbGVtZW50LmhyZWYpXHJcblxyXG4gICAgLy8gY2hhbmdlIHRpdGxlXHJcbiAgICBkb2N1bWVudC50aXRsZSA9IHRoaXMucmVzcG9uc2UudGl0bGVcclxuXHJcbiAgICAvLyBzZXQgbmV4dCBsaW5rXHJcbiAgICBjb25zdCBuZXdOZXh0RWxlbWVudCA9IHRoaXMucmVzcG9uc2UucXVlcnlTZWxlY3RvcignbGlua1tyZWw9bmV4dF0nKVxyXG4gICAgaWYgKG5ld05leHRFbGVtZW50KSB7XHJcbiAgICAgIG5leHRFbGVtZW50LmhyZWYgPSBuZXdOZXh0RWxlbWVudC5ocmVmXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgb25TY3JvbGwpXHJcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSlcclxuICAgIH1cclxuXHJcbiAgICAvLyBzeW5jIHN0YXR1c1xyXG4gICAgbGFzdERvY3VtZW50SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodFxyXG4gICAgdGlja2luZyA9IGZhbHNlXHJcbiAgICBsb2FkaW5nID0gZmFsc2VcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHVwZGF0ZSAoKSB7XHJcbiAgICAvLyByZXR1cm4gaWYgYWxyZWFkeSBsb2FkaW5nXHJcbiAgICBpZiAobG9hZGluZykgcmV0dXJuXHJcblxyXG4gICAgLy8gcmV0dXJuIGlmIG5vdCBzY3JvbGwgdG8gdGhlIGJvdHRvbVxyXG4gICAgaWYgKGxhc3RTY3JvbGxZICsgbGFzdFdpbmRvd0hlaWdodCA8PSBsYXN0RG9jdW1lbnRIZWlnaHQgLSBidWZmZXIpIHtcclxuICAgICAgdGlja2luZyA9IGZhbHNlXHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIGxvYWRpbmcgPSB0cnVlXHJcblxyXG4gICAgY29uc3QgeGhyID0gbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCgpXHJcbiAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2RvY3VtZW50J1xyXG5cclxuICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgYXBwZW5kQ29udGVudClcclxuXHJcbiAgICB4aHIub3BlbignR0VUJywgbmV4dEVsZW1lbnQuaHJlZilcclxuICAgIHhoci5zZW5kKG51bGwpXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZXF1ZXN0VGljayAoKSB7XHJcbiAgICB0aWNraW5nIHx8IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodXBkYXRlKVxyXG4gICAgdGlja2luZyA9IHRydWVcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG9uU2Nyb2xsICgpIHtcclxuICAgIGxhc3RTY3JvbGxZID0gd2luZG93LnNjcm9sbFlcclxuICAgIHJlcXVlc3RUaWNrKClcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG9uUmVzaXplICgpIHtcclxuICAgIGxhc3RXaW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHRcclxuICAgIGxhc3REb2N1bWVudEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHRcclxuICAgIHJlcXVlc3RUaWNrKClcclxuICB9XHJcblxyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBvblNjcm9sbCwgeyBwYXNzaXZlOiB0cnVlIH0pXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplKVxyXG5cclxuICByZXF1ZXN0VGljaygpXHJcbn0pKHdpbmRvdywgZG9jdW1lbnQpXHJcbiJdLCJmaWxlIjoiaW5maW5pdGUuanMifQ==
