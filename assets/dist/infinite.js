"use strict";

/**
 * Infinite Scroll
 */
(function (window, document) {
  // next link element
  var nextElement = document.querySelector('link[rel=next]');
  if (!nextElement) return; // post feed element

  var feedElement = document.querySelector('.post-feed');
  if (!feedElement) return; // pagination element

  var paginationElement = document.querySelector('.pagination');
  if (!paginationElement) return;
  var buffer = 300;
  var ticking = false;
  var loading = false;
  var lastScrollY = window.scrollY;
  var lastWindowHeight = window.innerHeight;
  var lastDocumentHeight = document.documentElement.scrollHeight;

  function appendContent() {
    if (this.status === 404) {
      window.removeEventListener('scroll', onScroll);
      window.removeEventListener('resize', onResize);
      return;
    } // // https://github.com/TryGhost/Casper/commit/41bcbb71570db0f829a2f0f1b5549f380d38d36a
    // document.createRange().createContextualFragment(this.responseText)
    // window.LazyLoad && new window.LazyLoad({ elements_selector: '[data-src]' })
    // append contents


    var postElements = this.response.querySelectorAll('.post-card');
    postElements.forEach(function (item) {
      return feedElement.appendChild(item);
    });
    window.lazyloader && window.lazyloader.update(); // append new pagination

    var newPaginationElement = this.response.querySelector('.pagination');
    paginationElement.innerHTML = newPaginationElement.innerHTML; // push state

    window.history.pushState(null, document.title, nextElement.href); // change title

    document.title = this.response.title; // set next link

    var newNextElement = this.response.querySelector('link[rel=next]');

    if (newNextElement) {
      nextElement.href = newNextElement.href;
    } else {
      window.removeEventListener('scroll', onScroll);
      window.removeEventListener('resize', onResize);
    } // sync status


    lastDocumentHeight = document.documentElement.scrollHeight;
    ticking = false;
    loading = false;
  }

  function update() {
    // return if already loading
    if (loading) return; // return if not scroll to the bottom

    if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {
      ticking = false;
      return;
    }

    loading = true;
    var xhr = new window.XMLHttpRequest();
    xhr.responseType = 'document';
    xhr.addEventListener('load', appendContent);
    xhr.open('GET', nextElement.href);
    xhr.send(null);
  }

  function requestTick() {
    ticking || window.requestAnimationFrame(update);
    ticking = true;
  }

  function onScroll() {
    lastScrollY = window.scrollY;
    requestTick();
  }

  function onResize() {
    lastWindowHeight = window.innerHeight;
    lastDocumentHeight = document.documentElement.scrollHeight;
    requestTick();
  }

  window.addEventListener('scroll', onScroll, {
    passive: true
  });
  window.addEventListener('resize', onResize);
  requestTick();
})(window, document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZmluaXRlLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsImRvY3VtZW50IiwibmV4dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZmVlZEVsZW1lbnQiLCJwYWdpbmF0aW9uRWxlbWVudCIsImJ1ZmZlciIsInRpY2tpbmciLCJsb2FkaW5nIiwibGFzdFNjcm9sbFkiLCJzY3JvbGxZIiwibGFzdFdpbmRvd0hlaWdodCIsImlubmVySGVpZ2h0IiwibGFzdERvY3VtZW50SGVpZ2h0IiwiZG9jdW1lbnRFbGVtZW50Iiwic2Nyb2xsSGVpZ2h0IiwiYXBwZW5kQ29udGVudCIsInN0YXR1cyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJvblNjcm9sbCIsIm9uUmVzaXplIiwicG9zdEVsZW1lbnRzIiwicmVzcG9uc2UiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBlbmRDaGlsZCIsImxhenlsb2FkZXIiLCJ1cGRhdGUiLCJuZXdQYWdpbmF0aW9uRWxlbWVudCIsImlubmVySFRNTCIsImhpc3RvcnkiLCJwdXNoU3RhdGUiLCJ0aXRsZSIsImhyZWYiLCJuZXdOZXh0RWxlbWVudCIsInhociIsIlhNTEh0dHBSZXF1ZXN0IiwicmVzcG9uc2VUeXBlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW4iLCJzZW5kIiwicmVxdWVzdFRpY2siLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJwYXNzaXZlIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7QUFJQSxDQUFDLFVBQVVBLE1BQVYsRUFBa0JDLFFBQWxCLEVBQTRCO0FBQzNCO0FBQ0EsTUFBTUMsV0FBVyxHQUFHRCxRQUFRLENBQUNFLGFBQVQsQ0FBdUIsZ0JBQXZCLENBQXBCO0FBQ0EsTUFBSSxDQUFDRCxXQUFMLEVBQWtCLE9BSFMsQ0FLM0I7O0FBQ0EsTUFBTUUsV0FBVyxHQUFHSCxRQUFRLENBQUNFLGFBQVQsQ0FBdUIsWUFBdkIsQ0FBcEI7QUFDQSxNQUFJLENBQUNDLFdBQUwsRUFBa0IsT0FQUyxD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QUFHLENBQUNHLGdCQUFKLENBQXFCLE1BQXJCLEVBQTZCdkIsYUFBN0I7QUFFQW9CLElBQUFBLEdBQUcsQ0FBQ0ksSUFBSixDQUFTLEtBQVQsRUFBZ0J0QyxXQUFXLENBQUNnQyxJQUE1QjtBQUNBRSxJQUFBQSxHQUFHLENBQUNLLElBQUosQ0FBUyxJQUFUO0FBQ0Q7O0FBRUQsV0FBU0MsV0FBVCxHQUF3QjtBQUN0Qm5DLElBQUFBLE9BQU8sSUFBSVAsTUFBTSxDQUFDMkMscUJBQVAsQ0FBNkJmLE1BQTdCLENBQVg7QUFDQXJCLElBQUFBLE9BQU8sR0FBRyxJQUFWO0FBQ0Q7O0FBRUQsV0FBU1ksUUFBVCxHQUFxQjtBQUNuQlYsSUFBQUEsV0FBVyxHQUFHVCxNQUFNLENBQUNVLE9BQXJCO0FBQ0FnQyxJQUFBQSxXQUFXO0FBQ1o7O0FBRUQsV0FBU3RCLFFBQVQsR0FBcUI7QUFDbkJULElBQUFBLGdCQUFnQixHQUFHWCxNQUFNLENBQUNZLFdBQTFCO0FBQ0FDLElBQUFBLGtCQUFrQixHQUFHWixRQUFRLENBQUNhLGVBQVQsQ0FBeUJDLFlBQTlDO0FBQ0EyQixJQUFBQSxXQUFXO0FBQ1o7O0FBRUQxQyxFQUFBQSxNQUFNLENBQUN1QyxnQkFBUCxDQUF3QixRQUF4QixFQUFrQ3BCLFFBQWxDLEVBQTRDO0FBQUV5QixJQUFBQSxPQUFPLEVBQUU7QUFBWCxHQUE1QztBQUNBNUMsRUFBQUEsTUFBTSxDQUFDdUMsZ0JBQVAsQ0FBd0IsUUFBeEIsRUFBa0NuQixRQUFsQztBQUVBc0IsRUFBQUEsV0FBVztBQUNaLENBeEdELEVBd0dHMUMsTUF4R0gsRUF3R1dDLFFBeEdYIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbmZpbml0ZSBTY3JvbGxcbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQpIHtcbiAgLy8gbmV4dCBsaW5rIGVsZW1lbnRcbiAgY29uc3QgbmV4dEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsaW5rW3JlbD1uZXh0XScpXG4gIGlmICghbmV4dEVsZW1lbnQpIHJldHVyblxuXG4gIC8vIHBvc3QgZmVlZCBlbGVtZW50XG4gIGNvbnN0IGZlZWRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvc3QtZmVlZCcpXG4gIGlmICghZmVlZEVsZW1lbnQpIHJldHVyblxuXG4gIC8vIHBhZ2luYXRpb24gZWxlbWVudFxuICBjb25zdCBwYWdpbmF0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYWdpbmF0aW9uJylcbiAgaWYgKCFwYWdpbmF0aW9uRWxlbWVudCkgcmV0dXJuXG5cbiAgY29uc3QgYnVmZmVyID0gMzAwXG5cbiAgbGV0IHRpY2tpbmcgPSBmYWxzZVxuICBsZXQgbG9hZGluZyA9IGZhbHNlXG5cbiAgbGV0IGxhc3RTY3JvbGxZID0gd2luZG93LnNjcm9sbFlcbiAgbGV0IGxhc3RXaW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgbGV0IGxhc3REb2N1bWVudEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHRcblxuICBmdW5jdGlvbiBhcHBlbmRDb250ZW50ICgpIHtcbiAgICBpZiAodGhpcy5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG9uU2Nyb2xsKVxuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgLy8gLy8gaHR0cHM6Ly9naXRodWIuY29tL1RyeUdob3N0L0Nhc3Blci9jb21taXQvNDFiY2JiNzE1NzBkYjBmODI5YTJmMGYxYjU1NDlmMzgwZDM4ZDM2YVxuICAgIC8vIGRvY3VtZW50LmNyZWF0ZVJhbmdlKCkuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KHRoaXMucmVzcG9uc2VUZXh0KVxuICAgIC8vIHdpbmRvdy5MYXp5TG9hZCAmJiBuZXcgd2luZG93LkxhenlMb2FkKHsgZWxlbWVudHNfc2VsZWN0b3I6ICdbZGF0YS1zcmNdJyB9KVxuXG4gICAgLy8gYXBwZW5kIGNvbnRlbnRzXG4gICAgY29uc3QgcG9zdEVsZW1lbnRzID0gdGhpcy5yZXNwb25zZS5xdWVyeVNlbGVjdG9yQWxsKCcucG9zdC1jYXJkJylcbiAgICBwb3N0RWxlbWVudHMuZm9yRWFjaChpdGVtID0+IGZlZWRFbGVtZW50LmFwcGVuZENoaWxkKGl0ZW0pKVxuICAgIHdpbmRvdy5sYXp5bG9hZGVyICYmIHdpbmRvdy5sYXp5bG9hZGVyLnVwZGF0ZSgpXG5cbiAgICAvLyBhcHBlbmQgbmV3IHBhZ2luYXRpb25cbiAgICBjb25zdCBuZXdQYWdpbmF0aW9uRWxlbWVudCA9IHRoaXMucmVzcG9uc2UucXVlcnlTZWxlY3RvcignLnBhZ2luYXRpb24nKVxuICAgIHBhZ2luYXRpb25FbGVtZW50LmlubmVySFRNTCA9IG5ld1BhZ2luYXRpb25FbGVtZW50LmlubmVySFRNTFxuXG4gICAgLy8gcHVzaCBzdGF0ZVxuICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBkb2N1bWVudC50aXRsZSwgbmV4dEVsZW1lbnQuaHJlZilcblxuICAgIC8vIGNoYW5nZSB0aXRsZVxuICAgIGRvY3VtZW50LnRpdGxlID0gdGhpcy5yZXNwb25zZS50aXRsZVxuXG4gICAgLy8gc2V0IG5leHQgbGlua1xuICAgIGNvbnN0IG5ld05leHRFbGVtZW50ID0gdGhpcy5yZXNwb25zZS5xdWVyeVNlbGVjdG9yKCdsaW5rW3JlbD1uZXh0XScpXG4gICAgaWYgKG5ld05leHRFbGVtZW50KSB7XG4gICAgICBuZXh0RWxlbWVudC5ocmVmID0gbmV3TmV4dEVsZW1lbnQuaHJlZlxuICAgIH0gZWxzZSB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgb25TY3JvbGwpXG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25SZXNpemUpXG4gICAgfVxuXG4gICAgLy8gc3luYyBzdGF0dXNcbiAgICBsYXN0RG9jdW1lbnRIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0XG4gICAgdGlja2luZyA9IGZhbHNlXG4gICAgbG9hZGluZyA9IGZhbHNlXG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGUgKCkge1xuICAgIC8vIHJldHVybiBpZiBhbHJlYWR5IGxvYWRpbmdcbiAgICBpZiAobG9hZGluZykgcmV0dXJuXG5cbiAgICAvLyByZXR1cm4gaWYgbm90IHNjcm9sbCB0byB0aGUgYm90dG9tXG4gICAgaWYgKGxhc3RTY3JvbGxZICsgbGFzdFdpbmRvd0hlaWdodCA8PSBsYXN0RG9jdW1lbnRIZWlnaHQgLSBidWZmZXIpIHtcbiAgICAgIHRpY2tpbmcgPSBmYWxzZVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgbG9hZGluZyA9IHRydWVcblxuICAgIGNvbnN0IHhociA9IG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKVxuICAgIHhoci5yZXNwb25zZVR5cGUgPSAnZG9jdW1lbnQnXG5cbiAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGFwcGVuZENvbnRlbnQpXG5cbiAgICB4aHIub3BlbignR0VUJywgbmV4dEVsZW1lbnQuaHJlZilcbiAgICB4aHIuc2VuZChudWxsKVxuICB9XG5cbiAgZnVuY3Rpb24gcmVxdWVzdFRpY2sgKCkge1xuICAgIHRpY2tpbmcgfHwgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh1cGRhdGUpXG4gICAgdGlja2luZyA9IHRydWVcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU2Nyb2xsICgpIHtcbiAgICBsYXN0U2Nyb2xsWSA9IHdpbmRvdy5zY3JvbGxZXG4gICAgcmVxdWVzdFRpY2soKVxuICB9XG5cbiAgZnVuY3Rpb24gb25SZXNpemUgKCkge1xuICAgIGxhc3RXaW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgICBsYXN0RG9jdW1lbnRIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0XG4gICAgcmVxdWVzdFRpY2soKVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG9uU2Nyb2xsLCB7IHBhc3NpdmU6IHRydWUgfSlcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplKVxuXG4gIHJlcXVlc3RUaWNrKClcbn0pKHdpbmRvdywgZG9jdW1lbnQpXG4iXSwiZmlsZSI6ImluZmluaXRlLmpzIn0=
