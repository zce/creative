"use strict";

/**
 * Infinite Scroll
 */
(function (window, document) {
  // next link element
  var nextElement = document.querySelector('link[rel=next]');
  if (!nextElement) return; // post feed element

  var feedElement = document.querySelector('.post-feed');
  if (!feedElement) return; // pagination element

  var paginationElement = document.querySelector('.pagination');
  var buffer = 300;
  var ticking = false;
  var loading = false;
  var lastScrollY = window.scrollY;
  var lastWindowHeight = window.innerHeight;
  var lastDocumentHeight = document.documentElement.scrollHeight;

  function appendContent() {
    if (this.status === 404) {
      window.removeEventListener('scroll', onScroll);
      window.removeEventListener('resize', onResize);
      return;
    } // // https://github.com/TryGhost/Casper/commit/41bcbb71570db0f829a2f0f1b5549f380d38d36a
    // document.createRange().createContextualFragment(this.responseText)
    // window.LazyLoad && new window.LazyLoad({ elements_selector: '[data-src]' })
    // append contents


    var postElements = this.response.querySelectorAll('.post-card');
    postElements.forEach(function (item) {
      return feedElement.appendChild(item);
    });
    window.lazyloader && window.lazyloader.update();

    if (paginationElement) {
      // append new pagination
      var newPaginationElement = this.response.querySelector('.pagination');
      paginationElement.innerHTML = newPaginationElement.innerHTML;
    } // push state


    window.history.pushState(null, document.title, nextElement.href); // change title

    document.title = this.response.title; // set next link

    var newNextElement = this.response.querySelector('link[rel=next]');

    if (newNextElement) {
      nextElement.href = newNextElement.href;
    } else {
      window.removeEventListener('scroll', onScroll);
      window.removeEventListener('resize', onResize);
    } // sync status


    lastDocumentHeight = document.documentElement.scrollHeight;
    ticking = false;
    loading = false;
  }

  function update() {
    // return if already loading
    if (loading) return; // return if not scroll to the bottom

    if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {
      ticking = false;
      return;
    }

    loading = true;
    var xhr = new window.XMLHttpRequest();
    xhr.responseType = 'document';
    xhr.addEventListener('load', appendContent);
    xhr.open('GET', nextElement.href);
    xhr.send(null);
  }

  function requestTick() {
    ticking || window.requestAnimationFrame(update);
    ticking = true;
  }

  function onScroll() {
    lastScrollY = window.scrollY;
    requestTick();
  }

  function onResize() {
    lastWindowHeight = window.innerHeight;
    lastDocumentHeight = document.documentElement.scrollHeight;
    requestTick();
  }

  window.addEventListener('scroll', onScroll, {
    passive: true
  });
  window.addEventListener('resize', onResize);
  requestTick();
})(window, document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZmluaXRlLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsImRvY3VtZW50IiwibmV4dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZmVlZEVsZW1lbnQiLCJwYWdpbmF0aW9uRWxlbWVudCIsImJ1ZmZlciIsInRpY2tpbmciLCJsb2FkaW5nIiwibGFzdFNjcm9sbFkiLCJzY3JvbGxZIiwibGFzdFdpbmRvd0hlaWdodCIsImlubmVySGVpZ2h0IiwibGFzdERvY3VtZW50SGVpZ2h0IiwiZG9jdW1lbnRFbGVtZW50Iiwic2Nyb2xsSGVpZ2h0IiwiYXBwZW5kQ29udGVudCIsInN0YXR1cyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJvblNjcm9sbCIsIm9uUmVzaXplIiwicG9zdEVsZW1lbnRzIiwicmVzcG9uc2UiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBlbmRDaGlsZCIsImxhenlsb2FkZXIiLCJ1cGRhdGUiLCJuZXdQYWdpbmF0aW9uRWxlbWVudCIsImlubmVySFRNTCIsImhpc3RvcnkiLCJwdXNoU3RhdGUiLCJ0aXRsZSIsImhyZWYiLCJuZXdOZXh0RWxlbWVudCIsInhociIsIlhNTEh0dHBSZXF1ZXN0IiwicmVzcG9uc2VUeXBlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW4iLCJzZW5kIiwicmVxdWVzdFRpY2siLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJwYXNzaXZlIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7QUFJQSxDQUFDLFVBQVVBLE1BQVYsRUFBa0JDLFFBQWxCLEVBQTRCO0FBQzNCO0FBQ0EsTUFBTUMsV0FBVyxHQUFHRCxRQUFRLENBQUNFLGFBQVQsQ0FBdUIsZ0JBQXZCLENBQXBCO0FBQ0EsTUFBSSxDQUFDRCxXQUFMLEVBQWtCLE9BSFMsQ0FLM0I7O0FBQ0EsTUFBTUUsV0FBVyxHQUFHSCxRQUFRLENBQUNFLGFBQVQsQ0FBdUIsWUFBdkIsQ0FBcEI7QUFDQSxNQUFJLENBQUNDLFdBQUwsRUFBa0IsT0FQUyxDQVMzQjs7QUFDQSxNQUFNQyxpQkFBaUIsR0FBR0osUUFBUSxDQUFDRSxhQUFULENBQXVCLGFBQXZCLENBQTFCO0FBRUEsTUFBTUcsTUFBTSxHQUFHLEdBQWY7QUFFQSxNQUFJQyxPQUFPLEdBQUcsS0FBZDtBQUNBLE1BQUlDLE9BQU8sR0FBRyxLQUFkO0FBRUEsTUFBSUMsV0FBVyxHQUFHVCxNQUFNLENBQUNVLE9BQXpCO0FBQ0EsTUFBSUMsZ0JBQWdCLEdBQUdYLE1BQU0sQ0FBQ1ksV0FBOUI7QUFDQSxNQUFJQyxrQkFBa0IsR0FBR1osUUFBUSxDQUFDYSxlQUFULENBQXlCQyxZQUFsRDs7QUFFQSxXQUFTQyxhQUFULEdBQTBCO0FBQ3hCLFFBQUksS0FBS0MsTUFBTCxLQUFnQixHQUFwQixFQUF5QjtBQUN2QmpCLE1BQUFBLE1BQU0sQ0FBQ2tCLG1CQUFQLENBQTJCLFFBQTNCLEVBQXFDQyxRQUFyQztBQUNBbkIsTUFBQUEsTUFBTSxDQUFDa0IsbUJBQVAsQ0FBMkIsUUFBM0IsRUFBcUNFLFFBQXJDO0FBQ0E7QUFDRCxLQUx1QixDQU94QjtBQUNBO0FBQ0E7QUFFQTs7O0FBQ0EsUUFBTUMsWUFBWSxHQUFHLEtBQUtDLFFBQUwsQ0FBY0MsZ0JBQWQsQ0FBK0IsWUFBL0IsQ0FBckI7QUFDQUYsSUFBQUEsWUFBWSxDQUFDRyxPQUFiLENBQXFCLFVBQUFDLElBQUk7QUFBQSxhQUFJckIsV0FBVyxDQUFDc0IsV0FBWixDQUF3QkQsSUFBeEIsQ0FBSjtBQUFBLEtBQXpCO0FBQ0F6QixJQUFBQSxNQUFNLENBQUMyQixVQUFQLElBQXFCM0IsTUFBTSxDQUFDMkIsVUFBUCxDQUFrQkMsTUFBbEIsRUFBckI7O0FBRUEsUUFBSXZCLGlCQUFKLEVBQXVCO0FBQ3JCO0FBQ0EsVUFBTXdCLG9CQUFvQixHQUFHLEtBQUtQLFFBQUwsQ0FBY25CLGFBQWQsQ0FBNEIsYUFBNUIsQ0FBN0I7QUFDQUUsTUFBQUEsaUJBQWlCLENBQUN5QixTQUFsQixHQUE4QkQsb0JBQW9CLENBQUNDLFNBQW5EO0FBQ0QsS0FwQnVCLENBc0J4Qjs7O0FBQ0E5QixJQUFBQSxNQUFNLENBQUMrQixPQUFQLENBQWVDLFNBQWYsQ0FBeUIsSUFBekIsRUFBK0IvQixRQUFRLENBQUNnQyxLQUF4QyxFQUErQy9CLFdBQVcsQ0FBQ2dDLElBQTNELEVBdkJ3QixDQXlCeEI7O0FBQ0FqQyxJQUFBQSxRQUFRLENBQUNnQyxLQUFULEdBQWlCLEtBQUtYLFFBQUwsQ0FBY1csS0FBL0IsQ0ExQndCLENBNEJ4Qjs7QUFDQSxRQUFNRSxjQUFjLEdBQUcsS0FBS2IsUUFBTCxDQUFjbkIsYUFBZCxDQUE0QixnQkFBNUIsQ0FBdkI7O0FBQ0EsUUFBSWdDLGNBQUosRUFBb0I7QUFDbEJqQyxNQUFBQSxXQUFXLENBQUNnQyxJQUFaLEdBQW1CQyxjQUFjLENBQUNELElBQWxDO0FBQ0QsS0FGRCxNQUVPO0FBQ0xsQyxNQUFBQSxNQUFNLENBQUNrQixtQkFBUCxDQUEyQixRQUEzQixFQUFxQ0MsUUFBckM7QUFDQW5CLE1BQUFBLE1BQU0sQ0FBQ2tCLG1CQUFQLENBQTJCLFFBQTNCLEVBQXFDRSxRQUFyQztBQUNELEtBbkN1QixDQXFDeEI7OztBQUNBUCxJQUFBQSxrQkFBa0IsR0FBR1osUUFBUSxDQUFDYSxlQUFULENBQXlCQyxZQUE5QztBQUNBUixJQUFBQSxPQUFPLEdBQUcsS0FBVjtBQUNBQyxJQUFBQSxPQUFPLEdBQUcsS0FBVjtBQUNEOztBQUVELFdBQVNvQixNQUFULEdBQW1CO0FBQ2pCO0FBQ0EsUUFBSXBCLE9BQUosRUFBYSxPQUZJLENBSWpCOztBQUNBLFFBQUlDLFdBQVcsR0FBR0UsZ0JBQWQsSUFBa0NFLGtCQUFrQixHQUFHUCxNQUEzRCxFQUFtRTtBQUNqRUMsTUFBQUEsT0FBTyxHQUFHLEtBQVY7QUFDQTtBQUNEOztBQUVEQyxJQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUVBLFFBQU00QixHQUFHLEdBQUcsSUFBSXBDLE1BQU0sQ0FBQ3FDLGNBQVgsRUFBWjtBQUNBRCxJQUFBQSxHQUFHLENBQUNFLFlBQUosR0FBbUIsVUFBbkI7QUFFQUYsSUFBQUEsR0FBRyxDQUFDRyxnQkFBSixDQUFxQixNQUFyQixFQUE2QnZCLGFBQTdCO0FBRUFvQixJQUFBQSxHQUFHLENBQUNJLElBQUosQ0FBUyxLQUFULEVBQWdCdEMsV0FBVyxDQUFDZ0MsSUFBNUI7QUFDQUUsSUFBQUEsR0FBRyxDQUFDSyxJQUFKLENBQVMsSUFBVDtBQUNEOztBQUVELFdBQVNDLFdBQVQsR0FBd0I7QUFDdEJuQyxJQUFBQSxPQUFPLElBQUlQLE1BQU0sQ0FBQzJDLHFCQUFQLENBQTZCZixNQUE3QixDQUFYO0FBQ0FyQixJQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUNEOztBQUVELFdBQVNZLFFBQVQsR0FBcUI7QUFDbkJWLElBQUFBLFdBQVcsR0FBR1QsTUFBTSxDQUFDVSxPQUFyQjtBQUNBZ0MsSUFBQUEsV0FBVztBQUNaOztBQUVELFdBQVN0QixRQUFULEdBQXFCO0FBQ25CVCxJQUFBQSxnQkFBZ0IsR0FBR1gsTUFBTSxDQUFDWSxXQUExQjtBQUNBQyxJQUFBQSxrQkFBa0IsR0FBR1osUUFBUSxDQUFDYSxlQUFULENBQXlCQyxZQUE5QztBQUNBMkIsSUFBQUEsV0FBVztBQUNaOztBQUVEMUMsRUFBQUEsTUFBTSxDQUFDdUMsZ0JBQVAsQ0FBd0IsUUFBeEIsRUFBa0NwQixRQUFsQyxFQUE0QztBQUFFeUIsSUFBQUEsT0FBTyxFQUFFO0FBQVgsR0FBNUM7QUFDQTVDLEVBQUFBLE1BQU0sQ0FBQ3VDLGdCQUFQLENBQXdCLFFBQXhCLEVBQWtDbkIsUUFBbEM7QUFFQXNCLEVBQUFBLFdBQVc7QUFDWixDQXpHRCxFQXlHRzFDLE1BekdILEVBeUdXQyxRQXpHWCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW5maW5pdGUgU2Nyb2xsXG4gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGRvY3VtZW50KSB7XG4gIC8vIG5leHQgbGluayBlbGVtZW50XG4gIGNvbnN0IG5leHRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbGlua1tyZWw9bmV4dF0nKVxuICBpZiAoIW5leHRFbGVtZW50KSByZXR1cm5cblxuICAvLyBwb3N0IGZlZWQgZWxlbWVudFxuICBjb25zdCBmZWVkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3N0LWZlZWQnKVxuICBpZiAoIWZlZWRFbGVtZW50KSByZXR1cm5cblxuICAvLyBwYWdpbmF0aW9uIGVsZW1lbnRcbiAgY29uc3QgcGFnaW5hdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFnaW5hdGlvbicpXG5cbiAgY29uc3QgYnVmZmVyID0gMzAwXG5cbiAgbGV0IHRpY2tpbmcgPSBmYWxzZVxuICBsZXQgbG9hZGluZyA9IGZhbHNlXG5cbiAgbGV0IGxhc3RTY3JvbGxZID0gd2luZG93LnNjcm9sbFlcbiAgbGV0IGxhc3RXaW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgbGV0IGxhc3REb2N1bWVudEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHRcblxuICBmdW5jdGlvbiBhcHBlbmRDb250ZW50ICgpIHtcbiAgICBpZiAodGhpcy5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG9uU2Nyb2xsKVxuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgLy8gLy8gaHR0cHM6Ly9naXRodWIuY29tL1RyeUdob3N0L0Nhc3Blci9jb21taXQvNDFiY2JiNzE1NzBkYjBmODI5YTJmMGYxYjU1NDlmMzgwZDM4ZDM2YVxuICAgIC8vIGRvY3VtZW50LmNyZWF0ZVJhbmdlKCkuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KHRoaXMucmVzcG9uc2VUZXh0KVxuICAgIC8vIHdpbmRvdy5MYXp5TG9hZCAmJiBuZXcgd2luZG93LkxhenlMb2FkKHsgZWxlbWVudHNfc2VsZWN0b3I6ICdbZGF0YS1zcmNdJyB9KVxuXG4gICAgLy8gYXBwZW5kIGNvbnRlbnRzXG4gICAgY29uc3QgcG9zdEVsZW1lbnRzID0gdGhpcy5yZXNwb25zZS5xdWVyeVNlbGVjdG9yQWxsKCcucG9zdC1jYXJkJylcbiAgICBwb3N0RWxlbWVudHMuZm9yRWFjaChpdGVtID0+IGZlZWRFbGVtZW50LmFwcGVuZENoaWxkKGl0ZW0pKVxuICAgIHdpbmRvdy5sYXp5bG9hZGVyICYmIHdpbmRvdy5sYXp5bG9hZGVyLnVwZGF0ZSgpXG5cbiAgICBpZiAocGFnaW5hdGlvbkVsZW1lbnQpIHtcbiAgICAgIC8vIGFwcGVuZCBuZXcgcGFnaW5hdGlvblxuICAgICAgY29uc3QgbmV3UGFnaW5hdGlvbkVsZW1lbnQgPSB0aGlzLnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3IoJy5wYWdpbmF0aW9uJylcbiAgICAgIHBhZ2luYXRpb25FbGVtZW50LmlubmVySFRNTCA9IG5ld1BhZ2luYXRpb25FbGVtZW50LmlubmVySFRNTFxuICAgIH1cblxuICAgIC8vIHB1c2ggc3RhdGVcbiAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgZG9jdW1lbnQudGl0bGUsIG5leHRFbGVtZW50LmhyZWYpXG5cbiAgICAvLyBjaGFuZ2UgdGl0bGVcbiAgICBkb2N1bWVudC50aXRsZSA9IHRoaXMucmVzcG9uc2UudGl0bGVcblxuICAgIC8vIHNldCBuZXh0IGxpbmtcbiAgICBjb25zdCBuZXdOZXh0RWxlbWVudCA9IHRoaXMucmVzcG9uc2UucXVlcnlTZWxlY3RvcignbGlua1tyZWw9bmV4dF0nKVxuICAgIGlmIChuZXdOZXh0RWxlbWVudCkge1xuICAgICAgbmV4dEVsZW1lbnQuaHJlZiA9IG5ld05leHRFbGVtZW50LmhyZWZcbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG9uU2Nyb2xsKVxuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplKVxuICAgIH1cblxuICAgIC8vIHN5bmMgc3RhdHVzXG4gICAgbGFzdERvY3VtZW50SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodFxuICAgIHRpY2tpbmcgPSBmYWxzZVxuICAgIGxvYWRpbmcgPSBmYWxzZVxuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlICgpIHtcbiAgICAvLyByZXR1cm4gaWYgYWxyZWFkeSBsb2FkaW5nXG4gICAgaWYgKGxvYWRpbmcpIHJldHVyblxuXG4gICAgLy8gcmV0dXJuIGlmIG5vdCBzY3JvbGwgdG8gdGhlIGJvdHRvbVxuICAgIGlmIChsYXN0U2Nyb2xsWSArIGxhc3RXaW5kb3dIZWlnaHQgPD0gbGFzdERvY3VtZW50SGVpZ2h0IC0gYnVmZmVyKSB7XG4gICAgICB0aWNraW5nID0gZmFsc2VcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGxvYWRpbmcgPSB0cnVlXG5cbiAgICBjb25zdCB4aHIgPSBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0KClcbiAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2RvY3VtZW50J1xuXG4gICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBhcHBlbmRDb250ZW50KVxuXG4gICAgeGhyLm9wZW4oJ0dFVCcsIG5leHRFbGVtZW50LmhyZWYpXG4gICAgeGhyLnNlbmQobnVsbClcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlcXVlc3RUaWNrICgpIHtcbiAgICB0aWNraW5nIHx8IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodXBkYXRlKVxuICAgIHRpY2tpbmcgPSB0cnVlXG4gIH1cblxuICBmdW5jdGlvbiBvblNjcm9sbCAoKSB7XG4gICAgbGFzdFNjcm9sbFkgPSB3aW5kb3cuc2Nyb2xsWVxuICAgIHJlcXVlc3RUaWNrKClcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUmVzaXplICgpIHtcbiAgICBsYXN0V2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0XG4gICAgbGFzdERvY3VtZW50SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodFxuICAgIHJlcXVlc3RUaWNrKClcbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBvblNjcm9sbCwgeyBwYXNzaXZlOiB0cnVlIH0pXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSlcblxuICByZXF1ZXN0VGljaygpXG59KSh3aW5kb3csIGRvY3VtZW50KVxuIl0sImZpbGUiOiJpbmZpbml0ZS5qcyJ9
