"use strict";

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Search page
 */
(function (window, document) {
  var key = 'q';

  var getQuery = function getQuery() {
    var hashes = window.location.search.slice(1).split('&');
    return hashes.reduce(function (params, hash) {
      var key = hash.split('=')[0];
      var value = hash.split('=')[1];
      return Object.assign(params, _defineProperty({}, key, decodeURIComponent(value)));
    }, {});
  };

  var compile = function compile(source) {
    return function (context) {
      /* eslint-disable no-new-func */
      var props = Object.keys(context).join(', ');
      return new Function("{ ".concat(props, " }"), "return `".concat(source, "`"))(context);
    };
  }; // 1. has search results container


  var resultElement = document.getElementById('results');
  if (!resultElement) return; // 2. enabled ghost api

  if (!window.ghost) return; // 3. has search querystring named q

  var query = getQuery()[key];
  if (!query) return; // 4. result item template

  var itemTmplSource = document.getElementById('item_tmpl');
  if (!itemTmplSource) return;
  var itemTemplate = compile(itemTmplSource.innerHTML); // replace title

  var titleElement = document.querySelector('.site-title');

  if (titleElement) {
    titleElement.innerHTML = titleElement.innerHTML.replace('%', query);
  }

  document.title = document.title.replace('%', query);
  var url = window.ghost.url.api('posts', {
    fields: ['url', 'title', 'feature_image'],
    formats: 'plaintext',
    absolute_urls: true
  });
  window.fetch(url).then(function (response) {
    return response.json();
  }).then(function (resources) {
    return window.fuzzysort.goAsync(query, resources.posts, {
      keys: ['title'],
      threshold: -3500,
      allowTypo: false
    });
  }).then(function (result) {
    resultElement.innerHTML = result.map(function (i) {
      return i.obj;
    }).map(itemTemplate).join('');
  })["catch"](function (error) {
    return console.error('Fetch Error =\n', error);
  });
})(window, document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlYXJjaC5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJkb2N1bWVudCIsImtleSIsImdldFF1ZXJ5IiwiaGFzaGVzIiwibG9jYXRpb24iLCJzZWFyY2giLCJzbGljZSIsInNwbGl0IiwicmVkdWNlIiwicGFyYW1zIiwiaGFzaCIsInZhbHVlIiwiT2JqZWN0IiwiYXNzaWduIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiY29tcGlsZSIsInNvdXJjZSIsImNvbnRleHQiLCJwcm9wcyIsImtleXMiLCJqb2luIiwiRnVuY3Rpb24iLCJyZXN1bHRFbGVtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnaG9zdCIsInF1ZXJ5IiwiaXRlbVRtcGxTb3VyY2UiLCJpdGVtVGVtcGxhdGUiLCJpbm5lckhUTUwiLCJ0aXRsZUVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicmVwbGFjZSIsInRpdGxlIiwidXJsIiwiYXBpIiwiZmllbGRzIiwiZm9ybWF0cyIsImFic29sdXRlX3VybHMiLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJyZXNvdXJjZXMiLCJmdXp6eXNvcnQiLCJnb0FzeW5jIiwicG9zdHMiLCJ0aHJlc2hvbGQiLCJhbGxvd1R5cG8iLCJyZXN1bHQiLCJtYXAiLCJpIiwib2JqIiwiZXJyb3IiLCJjb25zb2xlIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7OztBQUlBLENBQUMsVUFBVUEsTUFBVixFQUFrQkMsUUFBbEIsRUFBNEI7QUFDM0IsTUFBTUMsR0FBRyxHQUFHLEdBQVo7O0FBRUEsTUFBTUMsUUFBUSxHQUFHLFNBQVhBLFFBQVcsR0FBTTtBQUNyQixRQUFNQyxNQUFNLEdBQUdKLE1BQU0sQ0FBQ0ssUUFBUCxDQUFnQkMsTUFBaEIsQ0FBdUJDLEtBQXZCLENBQTZCLENBQTdCLEVBQWdDQyxLQUFoQyxDQUFzQyxHQUF0QyxDQUFmO0FBQ0EsV0FBT0osTUFBTSxDQUFDSyxNQUFQLENBQWMsVUFBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWtCO0FBQ3JDLFVBQU1U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QWQsR0FBMEJvQixNQUFNLENBQUNDLEdBQVAsQ0FBVyxVQUFBQyxDQUFDO0FBQUEsYUFBSUEsQ0FBQyxDQUFDQyxHQUFOO0FBQUEsS0FBWixFQUF1QkYsR0FBdkIsQ0FBMkJ0QixZQUEzQixFQUF5Q1AsSUFBekMsQ0FBOEMsRUFBOUMsQ0FBMUI7QUFDRCxHQVRILFdBVVMsVUFBQWdDLEtBQUs7QUFBQSxXQUFJQyxPQUFPLENBQUNELEtBQVIsQ0FBYyxpQkFBZCxFQUFpQ0EsS0FBakMsQ0FBSjtBQUFBLEdBVmQ7QUFXRCxDQXZERCxFQXVER3JELE1BdkRILEVBdURXQyxRQXZEWCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VhcmNoIHBhZ2VcbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQpIHtcbiAgY29uc3Qga2V5ID0gJ3EnXG5cbiAgY29uc3QgZ2V0UXVlcnkgPSAoKSA9PiB7XG4gICAgY29uc3QgaGFzaGVzID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zbGljZSgxKS5zcGxpdCgnJicpXG4gICAgcmV0dXJuIGhhc2hlcy5yZWR1Y2UoKHBhcmFtcywgaGFzaCkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gaGFzaC5zcGxpdCgnPScpWzBdXG4gICAgICBjb25zdCB2YWx1ZSA9IGhhc2guc3BsaXQoJz0nKVsxXVxuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24ocGFyYW1zLCB7IFtrZXldOiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpIH0pXG4gICAgfSwge30pXG4gIH1cblxuICBjb25zdCBjb21waWxlID0gc291cmNlID0+IHtcbiAgICByZXR1cm4gY29udGV4dCA9PiB7XG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1uZXctZnVuYyAqL1xuICAgICAgY29uc3QgcHJvcHMgPSBPYmplY3Qua2V5cyhjb250ZXh0KS5qb2luKCcsICcpXG4gICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKGB7ICR7cHJvcHN9IH1gLCBgcmV0dXJuIFxcYCR7c291cmNlfVxcYGApKGNvbnRleHQpXG4gICAgfVxuICB9XG5cbiAgLy8gMS4gaGFzIHNlYXJjaCByZXN1bHRzIGNvbnRhaW5lclxuICBjb25zdCByZXN1bHRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMnKVxuICBpZiAoIXJlc3VsdEVsZW1lbnQpIHJldHVyblxuXG4gIC8vIDIuIGVuYWJsZWQgZ2hvc3QgYXBpXG4gIGlmICghd2luZG93Lmdob3N0KSByZXR1cm5cblxuICAvLyAzLiBoYXMgc2VhcmNoIHF1ZXJ5c3RyaW5nIG5hbWVkIHFcbiAgY29uc3QgcXVlcnkgPSBnZXRRdWVyeSgpW2tleV1cbiAgaWYgKCFxdWVyeSkgcmV0dXJuXG5cbiAgLy8gNC4gcmVzdWx0IGl0ZW0gdGVtcGxhdGVcbiAgY29uc3QgaXRlbVRtcGxTb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbV90bXBsJylcbiAgaWYgKCFpdGVtVG1wbFNvdXJjZSkgcmV0dXJuXG4gIGNvbnN0IGl0ZW1UZW1wbGF0ZSA9IGNvbXBpbGUoaXRlbVRtcGxTb3VyY2UuaW5uZXJIVE1MKVxuXG4gIC8vIHJlcGxhY2UgdGl0bGVcbiAgY29uc3QgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpdGUtdGl0bGUnKVxuICBpZiAodGl0bGVFbGVtZW50KSB7XG4gICAgdGl0bGVFbGVtZW50LmlubmVySFRNTCA9IHRpdGxlRWxlbWVudC5pbm5lckhUTUwucmVwbGFjZSgnJScsIHF1ZXJ5KVxuICB9XG4gIGRvY3VtZW50LnRpdGxlID0gZG9jdW1lbnQudGl0bGUucmVwbGFjZSgnJScsIHF1ZXJ5KVxuXG4gIGNvbnN0IHVybCA9IHdpbmRvdy5naG9zdC51cmwuYXBpKCdwb3N0cycsIHsgZmllbGRzOiBbJ3VybCcsICd0aXRsZScsICdmZWF0dXJlX2ltYWdlJ10sIGZvcm1hdHM6ICdwbGFpbnRleHQnLCBhYnNvbHV0ZV91cmxzOiB0cnVlIH0pXG4gIHdpbmRvdy5mZXRjaCh1cmwpXG4gICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuICAgIC50aGVuKHJlc291cmNlcyA9PiB3aW5kb3cuZnV6enlzb3J0LmdvQXN5bmMocXVlcnksIHJlc291cmNlcy5wb3N0cywge1xuICAgICAga2V5czogWyAndGl0bGUnIF0sXG4gICAgICB0aHJlc2hvbGQ6IC0zNTAwLFxuICAgICAgYWxsb3dUeXBvOiBmYWxzZVxuICAgIH0pKVxuICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICByZXN1bHRFbGVtZW50LmlubmVySFRNTCA9IHJlc3VsdC5tYXAoaSA9PiBpLm9iaikubWFwKGl0ZW1UZW1wbGF0ZSkuam9pbignJylcbiAgICB9KVxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKCdGZXRjaCBFcnJvciA9XFxuJywgZXJyb3IpKVxufSkod2luZG93LCBkb2N1bWVudClcbiJdLCJmaWxlIjoic2VhcmNoLmpzIn0=
