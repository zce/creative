"use strict";

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Search page
 */
(function (window, document) {
  var key = 'q';

  var getQuery = function getQuery() {
    var hashes = window.location.search.slice(1).split('&');
    return hashes.reduce(function (params, hash) {
      var key = hash.split('=')[0];
      var value = hash.split('=')[1];
      return Object.assign(params, _defineProperty({}, key, decodeURIComponent(value)));
    }, {});
  };

  var compile = function compile(source) {
    return function (context) {
      /* eslint-disable no-new-func */
      var props = Object.keys(context).join(', ');
      return new Function("{ ".concat(props, " }"), "return `".concat(source, "`"))(context);
    };
  }; // 1. has search results container


  var resultElement = document.getElementById('results');
  if (!resultElement) return; // 2. enabled ghost api

  if (!window.ghost) return; // 3. has search querystring named q

  var query = getQuery()[key];
  if (!query) return; // 4. result item template

  var itemTmplSource = document.getElementById('item_tmpl');
  if (!itemTmplSource) return;
  var itemTemplate = compile(itemTmplSource.innerHTML); // replace title

  var titleElement = document.querySelector('.site-title');

  if (titleElement) {
    titleElement.innerHTML = titleElement.innerHTML.replace('%', query);
  }

  document.title = document.title.replace('%', query);
  var url = window.ghost.url.api('posts', {
    fields: ['url', 'title', 'feature_image'],
    formats: 'plaintext',
    absolute_urls: true
  });
  window.fetch(url).then(function (response) {
    return response.json();
  }).then(function (resources) {
    return window.fuzzysort.goAsync(query, resources.posts, {
      keys: ['title'],
      threshold: -3500,
      allowTypo: false
    });
  }).then(function (result) {
    resultElement.innerHTML = result.map(function (i) {
      return i.obj;
    }).map(itemTemplate).join('');
  })["catch"](function (error) {
    return console.error('Fetch Error =\n', error);
  });
})(window, document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlYXJjaC5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJkb2N1bWVudCIsImtleSIsImdldFF1ZXJ5IiwiaGFzaGVzIiwibG9jYXRpb24iLCJzZWFyY2giLCJzbGljZSIsInNwbGl0IiwicmVkdWNlIiwicGFyYW1zIiwiaGFzaCIsInZhbHVlIiwiT2JqZWN0IiwiYXNzaWduIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiY29tcGlsZSIsInNvdXJjZSIsImNvbnRleHQiLCJwcm9wcyIsImtleXMiLCJqb2luIiwiRnVuY3Rpb24iLCJyZXN1bHRFbGVtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnaG9zdCIsInF1ZXJ5IiwiaXRlbVRtcGxTb3VyY2UiLCJpdGVtVGVtcGxhdGUiLCJpbm5lckhUTUwiLCJ0aXRsZUVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicmVwbGFjZSIsInRpdGxlIiwidXJsIiwiYXBpIiwiZmllbGRzIiwiZm9ybWF0cyIsImFic29sdXRlX3VybHMiLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJyZXNvdXJjZXMiLCJmdXp6eXNvcnQiLCJnb0FzeW5jIiwicG9zdHMiLCJ0aHJlc2hvbGQiLCJhbGxvd1R5cG8iLCJyZXN1bHQiLCJtYXAiLCJpIiwib2JqIiwiZXJyb3IiLCJjb25zb2xlIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7OztBQUlBLENBQUMsVUFBVUEsTUFBVixFQUFrQkMsUUFBbEIsRUFBNEI7QUFDM0IsTUFBTUMsR0FBRyxHQUFHLEdBQVo7O0FBRUEsTUFBTUMsUUFBUSxHQUFHLFNBQVhBLFFBQVcsR0FBTTtBQUNyQixRQUFNQyxNQUFNLEdBQUdKLE1BQU0sQ0FBQ0ssUUFBUCxDQUFnQkMsTUFBaEIsQ0FBdUJDLEtBQXZCLENBQTZCLENBQTdCLEVBQWdDQyxLQUFoQyxDQUFzQyxHQUF0QyxDQUFmO0FBQ0EsV0FBT0osTUFBTSxDQUFDSyxNQUFQLENBQWMsVUFBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWtCO0FBQ3JDLFVBQU1U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QWQsR0FBMEJvQixNQUFNLENBQUNDLEdBQVAsQ0FBVyxVQUFBQyxDQUFDO0FBQUEsYUFBSUEsQ0FBQyxDQUFDQyxHQUFOO0FBQUEsS0FBWixFQUF1QkYsR0FBdkIsQ0FBMkJ0QixZQUEzQixFQUF5Q1AsSUFBekMsQ0FBOEMsRUFBOUMsQ0FBMUI7QUFDRCxHQVRILFdBVVMsVUFBQWdDLEtBQUs7QUFBQSxXQUFJQyxPQUFPLENBQUNELEtBQVIsQ0FBYyxpQkFBZCxFQUFpQ0EsS0FBakMsQ0FBSjtBQUFBLEdBVmQ7QUFXRCxDQXZERCxFQXVER3JELE1BdkRILEVBdURXQyxRQXZEWCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBTZWFyY2ggcGFnZVxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCkge1xyXG4gIGNvbnN0IGtleSA9ICdxJ1xyXG5cclxuICBjb25zdCBnZXRRdWVyeSA9ICgpID0+IHtcclxuICAgIGNvbnN0IGhhc2hlcyA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc2xpY2UoMSkuc3BsaXQoJyYnKVxyXG4gICAgcmV0dXJuIGhhc2hlcy5yZWR1Y2UoKHBhcmFtcywgaGFzaCkgPT4ge1xyXG4gICAgICBjb25zdCBrZXkgPSBoYXNoLnNwbGl0KCc9JylbMF1cclxuICAgICAgY29uc3QgdmFsdWUgPSBoYXNoLnNwbGl0KCc9JylbMV1cclxuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24ocGFyYW1zLCB7IFtrZXldOiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpIH0pXHJcbiAgICB9LCB7fSlcclxuICB9XHJcblxyXG4gIGNvbnN0IGNvbXBpbGUgPSBzb3VyY2UgPT4ge1xyXG4gICAgcmV0dXJuIGNvbnRleHQgPT4ge1xyXG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1uZXctZnVuYyAqL1xyXG4gICAgICBjb25zdCBwcm9wcyA9IE9iamVjdC5rZXlzKGNvbnRleHQpLmpvaW4oJywgJylcclxuICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbihgeyAke3Byb3BzfSB9YCwgYHJldHVybiBcXGAke3NvdXJjZX1cXGBgKShjb250ZXh0KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gMS4gaGFzIHNlYXJjaCByZXN1bHRzIGNvbnRhaW5lclxyXG4gIGNvbnN0IHJlc3VsdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cycpXHJcbiAgaWYgKCFyZXN1bHRFbGVtZW50KSByZXR1cm5cclxuXHJcbiAgLy8gMi4gZW5hYmxlZCBnaG9zdCBhcGlcclxuICBpZiAoIXdpbmRvdy5naG9zdCkgcmV0dXJuXHJcblxyXG4gIC8vIDMuIGhhcyBzZWFyY2ggcXVlcnlzdHJpbmcgbmFtZWQgcVxyXG4gIGNvbnN0IHF1ZXJ5ID0gZ2V0UXVlcnkoKVtrZXldXHJcbiAgaWYgKCFxdWVyeSkgcmV0dXJuXHJcblxyXG4gIC8vIDQuIHJlc3VsdCBpdGVtIHRlbXBsYXRlXHJcbiAgY29uc3QgaXRlbVRtcGxTb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbV90bXBsJylcclxuICBpZiAoIWl0ZW1UbXBsU291cmNlKSByZXR1cm5cclxuICBjb25zdCBpdGVtVGVtcGxhdGUgPSBjb21waWxlKGl0ZW1UbXBsU291cmNlLmlubmVySFRNTClcclxuXHJcbiAgLy8gcmVwbGFjZSB0aXRsZVxyXG4gIGNvbnN0IHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaXRlLXRpdGxlJylcclxuICBpZiAodGl0bGVFbGVtZW50KSB7XHJcbiAgICB0aXRsZUVsZW1lbnQuaW5uZXJIVE1MID0gdGl0bGVFbGVtZW50LmlubmVySFRNTC5yZXBsYWNlKCclJywgcXVlcnkpXHJcbiAgfVxyXG4gIGRvY3VtZW50LnRpdGxlID0gZG9jdW1lbnQudGl0bGUucmVwbGFjZSgnJScsIHF1ZXJ5KVxyXG5cclxuICBjb25zdCB1cmwgPSB3aW5kb3cuZ2hvc3QudXJsLmFwaSgncG9zdHMnLCB7IGZpZWxkczogWyd1cmwnLCAndGl0bGUnLCAnZmVhdHVyZV9pbWFnZSddLCBmb3JtYXRzOiAncGxhaW50ZXh0JywgYWJzb2x1dGVfdXJsczogdHJ1ZSB9KVxyXG4gIHdpbmRvdy5mZXRjaCh1cmwpXHJcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAudGhlbihyZXNvdXJjZXMgPT4gd2luZG93LmZ1enp5c29ydC5nb0FzeW5jKHF1ZXJ5LCByZXNvdXJjZXMucG9zdHMsIHtcclxuICAgICAga2V5czogWyAndGl0bGUnIF0sXHJcbiAgICAgIHRocmVzaG9sZDogLTM1MDAsXHJcbiAgICAgIGFsbG93VHlwbzogZmFsc2VcclxuICAgIH0pKVxyXG4gICAgLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgcmVzdWx0RWxlbWVudC5pbm5lckhUTUwgPSByZXN1bHQubWFwKGkgPT4gaS5vYmopLm1hcChpdGVtVGVtcGxhdGUpLmpvaW4oJycpXHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoJ0ZldGNoIEVycm9yID1cXG4nLCBlcnJvcikpXHJcbn0pKHdpbmRvdywgZG9jdW1lbnQpXHJcbiJdLCJmaWxlIjoic2VhcmNoLmpzIn0=
